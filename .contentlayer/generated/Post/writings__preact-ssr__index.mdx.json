{
  "title": "(P)reacting on the server side",
  "date": "2018-09-30T00:00:00.000Z",
  "description": "We use Preact and Node to build server side rendered web pages. Blazing fast webpages can be built using Preact.",
  "banner": "banner.jpg",
  "body": {
    "raw": "\nIt takes time to realise Server-side rendering is amazing.ðŸ˜ It was the same for me. You get a ton of benefits with it. Mainly, **first meaningful paint** of the webpage is quick. It still has to download the `js` to make it interactive. But, users will **not** be staring at white (empty) pages for long.\n\nAs you might know, [Preact](https://preactjs.com/) is the 3KB alternative to React. It is a bit faster than React and very less in size. The API is mostly same and easy to adapt if you are coming from React.\n\nLet's see how we can do that using Node on the server. We will be using `preact-router` for the routing at the client side.\n\nThis is the [repo](https://github.com/aravindballa/preact-ssr) that I have created, if you want to follow along.\n\n## `mkdir`\n\nCreate an empty directory and `npm init` it!\n\nNow, we install the necessary things.\n\n```bash\nyarn add preact preact-router preact-render-to-string express\n\nyarn add -D webpack webpack-cli babel-core babel-cli babel-loader\nbabel-preset-env babel-plugin-transform-react-jsx babel-register\n```\n\nThere are a few new packages that are helping us here.\n\n`preact-render-to-string` - This will help us render the App to string so that we can include this in the HTML that we send out to the client.\n\n`babel-register` - helps in transpiling ES6 code at run time on the server.\n\n## Webpack ðŸ”·\n\nLook at the repo to see how the project is structured. `client` folder contains the Preact code and the `webpack` is configured to generate a build from that folder to a file.\n\n```javascript\nmodule.exports = {\n  entry: {\n    app: './client/index.js',\n  },\n  output: {\n    path: path.join(__dirname, 'dist'),\n    filename: '[name].js',\n  },\n  module: {\n    rules: [\n      {\n        test: /\\.js$/,\n        loader: 'babel-loader',\n      },\n    ],\n  },\n};\n```\n\n## Server ðŸš€\n\nThe main file is `index.js` here where it requires babel to be present at runtime and help in transpiling code.\n\n```javascript\nrequire('babel-register')({\n  presets: ['env'],\n  plugins: [['transform-react-jsx', { pragma: 'h' }]],\n});\nrequire('./server');\n```\n\n`{\"pragma\": \"h\"}` is given as an option to the `transform-react-jsx` babel plugin because we are dealing with Preact and `createElement` is `h()` in it.\n\nBabel can do the magic once you tell this to it. âœ¨\n\nNow we have `server.js` where the rendering logic is present.\n\n```javascript\nconst express = require('express');\nconst { h } = require('preact');\nconst renderToString = require('preact-render-to-string');\nconst path = require('path');\nconst chalk = require('chalk');\n\nconst App = require('./client/App');\n\nconst app = express();\nconst port = 8080;\n\napp.use(express.static(path.join(__dirname, 'dist')));\n\napp.listen(port);\n\napp.get('*', (req, res) => {\n  const html = renderToString(<App />);\n\n  res.send(`\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n  <title>Preact SSR</title>\n</head>\n<body>\n  <div id=\"app\">${html}</div>\n  <script src=\"./app.js\"></script>\n</body>\n</html>\n    `);\n});\n\nconsole.log(chalk.blue(`Server started at http://localhost:${port}`));\n```\n\nSee how we are generating `html` and including it in `res.send()`. We include the Webpack output, `app.js`, as a script tag. As we have set `express.static` as the `dist` directory, Express will serve that folder as well.\n\nThat's it.\n\n## ðŸƒ\n\nRun `node index.js` to see the magic. ðŸŽ‰\n\nTake Care\n",
    "code": "var Component=(()=>{var h=Object.create;var a=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var b=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),w=(t,e)=>{for(var r in e)a(t,r,{get:e[r],enumerable:!0})},c=(t,e,r,s)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let i of g(e))!m.call(t,i)&&i!==r&&a(t,i,{get:()=>e[i],enumerable:!(s=p(e,i))||s.enumerable});return t};var f=(t,e,r)=>(r=t!=null?h(u(t)):{},c(e||!t||!t.__esModule?a(r,\"default\",{value:t,enumerable:!0}):r,t)),v=t=>c(a({},\"__esModule\",{value:!0}),t);var d=b((T,o)=>{o.exports=_jsx_runtime});var k={};w(k,{default:()=>y,frontmatter:()=>j});var n=f(d()),j={title:\"(P)reacting on the server side\",date:\"2018-09-30\",type:\"Post\",description:\"We use Preact and Node to build server side rendered web pages. Blazing fast webpages can be built using Preact.\",banner:\"banner.jpg\"};function l(t){let e=Object.assign({p:\"p\",strong:\"strong\",code:\"code\",a:\"a\",h2:\"h2\",pre:\"pre\"},t.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.p,{children:[\"It takes time to realise Server-side rendering is amazing.\\u{1F601} It was the same for me. You get a ton of benefits with it. Mainly, \",(0,n.jsx)(e.strong,{children:\"first meaningful paint\"}),\" of the webpage is quick. It still has to download the \",(0,n.jsx)(e.code,{children:\"js\"}),\" to make it interactive. But, users will \",(0,n.jsx)(e.strong,{children:\"not\"}),\" be staring at white (empty) pages for long.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"As you might know, \",(0,n.jsx)(e.a,{href:\"https://preactjs.com/\",children:\"Preact\"}),\" is the 3KB alternative to React. It is a bit faster than React and very less in size. The API is mostly same and easy to adapt if you are coming from React.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Let's see how we can do that using Node on the server. We will be using \",(0,n.jsx)(e.code,{children:\"preact-router\"}),\" for the routing at the client side.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"This is the \",(0,n.jsx)(e.a,{href:\"https://github.com/aravindballa/preact-ssr\",children:\"repo\"}),\" that I have created, if you want to follow along.\"]}),`\n`,(0,n.jsx)(e.h2,{children:(0,n.jsx)(e.code,{children:\"mkdir\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Create an empty directory and \",(0,n.jsx)(e.code,{children:\"npm init\"}),\" it!\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Now, we install the necessary things.\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-bash\",children:`yarn add preact preact-router preact-render-to-string express\n\nyarn add -D webpack webpack-cli babel-core babel-cli babel-loader\nbabel-preset-env babel-plugin-transform-react-jsx babel-register\n`})}),`\n`,(0,n.jsx)(e.p,{children:\"There are a few new packages that are helping us here.\"}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"preact-render-to-string\"}),\" - This will help us render the App to string so that we can include this in the HTML that we send out to the client.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"babel-register\"}),\" - helps in transpiling ES6 code at run time on the server.\"]}),`\n`,(0,n.jsx)(e.h2,{children:\"Webpack \\u{1F537}\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Look at the repo to see how the project is structured. \",(0,n.jsx)(e.code,{children:\"client\"}),\" folder contains the Preact code and the \",(0,n.jsx)(e.code,{children:\"webpack\"}),\" is configured to generate a build from that folder to a file.\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-javascript\",children:`module.exports = {\n  entry: {\n    app: './client/index.js',\n  },\n  output: {\n    path: path.join(__dirname, 'dist'),\n    filename: '[name].js',\n  },\n  module: {\n    rules: [\n      {\n        test: /\\\\.js$/,\n        loader: 'babel-loader',\n      },\n    ],\n  },\n};\n`})}),`\n`,(0,n.jsx)(e.h2,{children:\"Server \\u{1F680}\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"The main file is \",(0,n.jsx)(e.code,{children:\"index.js\"}),\" here where it requires babel to be present at runtime and help in transpiling code.\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-javascript\",children:`require('babel-register')({\n  presets: ['env'],\n  plugins: [['transform-react-jsx', { pragma: 'h' }]],\n});\nrequire('./server');\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:'{\"pragma\": \"h\"}'}),\" is given as an option to the \",(0,n.jsx)(e.code,{children:\"transform-react-jsx\"}),\" babel plugin because we are dealing with Preact and \",(0,n.jsx)(e.code,{children:\"createElement\"}),\" is \",(0,n.jsx)(e.code,{children:\"h()\"}),\" in it.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Babel can do the magic once you tell this to it. \\u2728\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Now we have \",(0,n.jsx)(e.code,{children:\"server.js\"}),\" where the rendering logic is present.\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-javascript\",children:`const express = require('express');\nconst { h } = require('preact');\nconst renderToString = require('preact-render-to-string');\nconst path = require('path');\nconst chalk = require('chalk');\n\nconst App = require('./client/App');\n\nconst app = express();\nconst port = 8080;\n\napp.use(express.static(path.join(__dirname, 'dist')));\n\napp.listen(port);\n\napp.get('*', (req, res) => {\n  const html = renderToString(<App />);\n\n  res.send(\\`\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n  <title>Preact SSR</title>\n</head>\n<body>\n  <div id=\"app\">\\${html}</div>\n  <script src=\"./app.js\"><\\/script>\n</body>\n</html>\n    \\`);\n});\n\nconsole.log(chalk.blue(\\`Server started at http://localhost:\\${port}\\`));\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"See how we are generating \",(0,n.jsx)(e.code,{children:\"html\"}),\" and including it in \",(0,n.jsx)(e.code,{children:\"res.send()\"}),\". We include the Webpack output, \",(0,n.jsx)(e.code,{children:\"app.js\"}),\", as a script tag. As we have set \",(0,n.jsx)(e.code,{children:\"express.static\"}),\" as the \",(0,n.jsx)(e.code,{children:\"dist\"}),\" directory, Express will serve that folder as well.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"That's it.\"}),`\n`,(0,n.jsx)(e.h2,{children:\"\\u{1F3C3}\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Run \",(0,n.jsx)(e.code,{children:\"node index.js\"}),\" to see the magic. \\u{1F389}\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Take Care\"})]})}function x(t={}){let{wrapper:e}=t.components||{};return e?(0,n.jsx)(e,Object.assign({},t,{children:(0,n.jsx)(l,t)})):l(t)}var y=x;return v(k);})();\n;return Component;"
  },
  "_id": "writings/preact-ssr/index.mdx",
  "_raw": {
    "sourceFilePath": "writings/preact-ssr/index.mdx",
    "sourceFileName": "index.mdx",
    "sourceFileDir": "writings/preact-ssr",
    "contentType": "mdx",
    "flattenedPath": "writings/preact-ssr"
  },
  "type": "Post",
  "slug": "/writings/preact-ssr"
}